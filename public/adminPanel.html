<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>ChaosNet - Admin Panel</title>
  <link rel="icon" type="image/png" href="img/ChaosNetLogo.png" />
  <link rel="shortcut icon" href="img/ChaosNetLogo.png" type="image/png"/>
  <link rel="stylesheet" href="css/mainStyle.css" />
  <link rel="stylesheet" href="css/adminPanel.css" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- iOS home screen icon + web app meta -->
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
  <link rel="apple-touch-icon" href="/img/ChaosNetLogo.png">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-title" content="ChaosNet">
  <meta name="viewport" content="width=device-width, initial-scale=1">

</head>
<body>
<a href="select.html" 
  style="position: fixed; top: 10px; right: 10px; 
         background-color: #2b2b2b; 
         color: #ff8c00; 
         border: none; 
         padding: 8px 14px; 
         border-radius: 8px; 
         cursor: pointer; 
         font-size: 14px; 
         text-decoration: none; 
         box-shadow: 0 0 10px rgba(255, 140, 0, 0.2);">
  Back
</a>

  <h1>Admin Panel</h1>
  <a href="NewName.html" class="button-link">Go to Name Page</a>

  <div class="chat-rooms-container">
    <h2>Active Chat Rooms</h2>
    <ul id="activeRoomsList"></ul>
  </div>


  <div style="margin: 20px 10px;">
    <h3>Admin Commands</h3>
    <input id="adminCommandInput" type="text" placeholder="/give admin nick, /take admin nick, or /kill nick"
           style="width: 100%; padding: 10px; border-radius: 6px; border: none; background: #2b2b2b; color: #fff;">
    <button onclick="handleAdminCommand()" 
            style="margin-top: 10px; padding: 8px 14px; background-color: #ff8c00; color: white; border: none; border-radius: 6px; cursor: pointer;">
      Execute
    </button>
    <div id="adminCommandResult" style="margin-top: 10px; color: #ccc;"></div>
  </div>

  <script>
    async function fetchActiveRooms() {
      try {
        const res = await fetch('/active-rooms');
        const rooms = await res.json();
        const list = document.getElementById('activeRoomsList');
        list.innerHTML = rooms.map(room => `<li class="admin-room-item">${room}</li>`).join('');
      } catch (err) {
        console.error('Error fetching active rooms:', err);
      }
    }

    fetchActiveRooms();
    setInterval(fetchActiveRooms, 5000);

    async function handleAdminCommand() {
      const input = document.getElementById('adminCommandInput').value.trim();
      const resultEl = document.getElementById('adminCommandResult');

      const [cmd, roleOrNick, nickMaybe] = input.split(' ');
      const cmdLower = cmd.toLowerCase();

      if ((cmdLower === '/give' || cmdLower === '/take') && roleOrNick === 'admin' && nickMaybe) {
        const res = await fetch('/set-admin', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            nick: nickMaybe,
            isAdmin: cmdLower === '/give'
          })
        });

        const text = await res.text();
        resultEl.textContent = text;
      } else if (cmdLower === '/kill') {
        const res = await fetch('/admin-action', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ command: input })
        });

        const text = await res.text();
        resultEl.textContent = text;
      } else {
        resultEl.textContent = "Invalid command. Use /give admin nick, /take admin nick, or /kill nick.";
      }
    }
  </script>
</body>
</html>